WPForms.Admin.Builder.Coupons=WPForms.Admin.Builder.Coupons||function(o,e,s){const n={fieldType:"payment-coupon",selectors:{buttonTextInput:".wpforms-field-option-row-button_text input",allowedCouponsSelect:".wpforms-field-option-row-allowed_coupons select",allowedFormsHiddenInput:".wpforms-coupons-allowed_coupons_json",allowedCouponsAlert:".wpforms-alert",allowedCouponsPreviewAlert:".fa-exclamation-triangle",buttonPreview:".wpforms-field-payment-coupon-button",fieldOptionRow:".wpforms-field-option-row",noCouponsButton:".wpforms-add-fields-button-no-coupons",addField:"#wpforms-add-fields-payment-coupon"},classes:{disabledAddButton:"wpforms-add-fields-button-disabled",noCouponsAddButton:"wpforms-add-fields-button-no-coupons"},init(){s(n.ready)},ready(){n.events(),n.initChoicesJS()},events(){s(o).on("input",n.selectors.buttonTextInput,n.updateButtonPreview).on("change",n.selectors.allowedCouponsSelect,n.changeAllowedCoupons).on("wpformsBeforeFieldAddOnClick",n.lockField).on("wpformsFieldAddDragStart",n.lockField).on("click",n.selectors.noCouponsButton,n.noCouponsPopup).on("wpformsFieldAdd",n.initChoicesJS).on("wpformsFieldDelete",(o,e,t)=>{n.unlockField(t)}).on("wpformsFieldAddDragStop",(o,e)=>{n.unlockField(e)}).on("wpformsFieldOptionTabToggle",(o,e)=>{n.reInitChoices(e)})},initChoicesJS(){"function"==typeof e.Choices&&s(n.selectors.allowedCouponsSelect+":not(.choices__input)").each(function(){var o=s(this),e=new Choices(o.get(0),{shouldSort:!1,removeItemButton:!0,renderChoicesLimit:5,callbackOnInit(){wpf.showMoreButtonForChoices(this.containerOuter.element)}});o.data("choicesjs",e)})},reInitChoices(o){s("#wpforms-field-option-"+o).find(".wpforms-field-option-hidden-type").val()===n.fieldType&&(o=s("#wpforms-field-option-row-"+o+"-allowed_coupons").find(".choices select").data("choicesjs"),wpf.showMoreButtonForChoices(o.containerOuter.element))},updateAllowedCouponsField(o){var e=o.closest(n.selectors.fieldOptionRow),t=[];for(const s of o.data("choicesjs").getValue())t.push(parseInt(s.value,10));e.find(n.selectors.allowedFormsHiddenInput).val(JSON.stringify(t))},noCouponsPopup(o){o.preventDefault(),s.alert({title:wpforms_builder.coupons.no_coupons_title,content:wpforms_builder.coupons.no_coupons_message,icon:"fa fa-info-circle",type:"orange",buttons:{confirm:{text:wpforms_builder.coupons.no_coupons_button,btnClass:"btn-confirm",keys:["enter"],action(){wpforms_builder.exit_url=wpforms_builder.coupons.add_new_coupon_url,WPFormsBuilder.formSave(!0)}},cancel:{text:wpforms_builder.cancel}}})},updateButtonPreview(){var o=s(this),e=o.val().trim(),o=o.closest(n.selectors.fieldOptionRow).data("field-id"),o=s("#wpforms-field-"+o).find(n.selectors.buttonPreview),e=e||wpforms_builder.coupons.button_text;o.text(e)},changeAllowedCoupons(){var o=s(this).closest(n.selectors.fieldOptionRow),e=o.data("field-id"),o=o.find(n.selectors.allowedCouponsAlert),e=s("#wpforms-field-"+e).find(n.selectors.allowedCouponsPreviewAlert),t=0===s(this).val().length;n.updateAllowedCouponsField(s(this)),t?(o.show(),e.show()):(o.hide(),e.hide())},lockField(o,e){e===n.fieldType&&((e=s(n.selectors.addField)).hasClass(n.classes.disabledAddButton)||e.hasClass(n.classes.noCouponsAddButton)?o.preventDefault():s(n.selectors.addField).addClass(n.classes.disabledAddButton))},unlockField(o){o===n.fieldType&&s(n.selectors.addField).removeClass(n.classes.disabledAddButton)}};return n}(document,window,jQuery),WPForms.Admin.Builder.Coupons.init();