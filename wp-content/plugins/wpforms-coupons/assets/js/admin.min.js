"use strict";const WPFormsCouponsAdmin=window.WPFormsCouponsAdmin||function(e,t,r){const a={el:{holder:r("#wpforms-coupons"),form:r("form.wpforms-admin-settings-form"),formsToggles:r(".wpforms-coupon-allowed-forms tbody .wpforms-coupon-toggle-control input"),isGlobalToggle:r("#wpforms-coupons-is_global"),tooltips:r(".wpforms-coupons-tooltip")},vars:{},init:function(){r(a.ready)},ready:function(){a.events(),a.initSavedFormData(),a.dateTimePicker.init(),a.tooltips.init()},events:function(){a.el.holder.on("click",".wpforms-btn-coupon-generate",a.generateCouponCode).on("click","#wpforms-coupons-is_global",a.toggleAllowedFormsGlobal).on("click",".wpforms-coupons-show-all-forms",a.showAllForms).on("click",".wpforms-coupon-allowed-forms tbody .wpforms-coupon-toggle-control input",a.toggleSingleForm).on("submit","form.wpforms-admin-settings-form",a.submitForm).on("change","#wpforms-coupons-amount-type",a.changeStep),r(t).on("beforeunload",a.beforeUnload)},initSavedFormData:function(){a.vars.savedFormData=a.el.form.serialize(),a.vars.isReloadConfirmed=!1},dateTimePicker:{el:{wrapper:r("#wpforms-coupon-datetime-block"),$clearButton:r(".wpforms-clear-datetime-field"),scheduling:{start:{$dpicker:r("#wpforms-coupons-start_date"),$tpicker:r("#wpforms-coupons-start_time")},end:{$dpicker:r("#wpforms-coupons-end_date"),$tpicker:r("#wpforms-coupons-end_time")}}},init:function(){a.dateTimePicker.el.wrapper.length&&(a.dateTimePicker.datePickerInit(),a.dateTimePicker.timePickerInit(),a.dateTimePicker.datePairInit(),a.dateTimePicker.clearButtonsInit(),a.dateTimePicker.updatePairedField(),a.dateTimePicker.events())},events:function(){r(e).on("click",".wpforms-clear-datetime-field",a.dateTimePicker.resetField).on("change","input","#wpforms-coupon-datetime-block",a.dateTimePicker.updatePairedField)},datePickerInit:function(){void 0!==r.fn.flatpickr&&(a.dateTimePicker.el.scheduling.start.$dpicker.flatpickr(a.dateTimePicker.getArgs("start")),a.dateTimePicker.el.scheduling.end.$dpicker.flatpickr(a.dateTimePicker.getArgs("end")))},timePickerInit:function(){var e;void 0!==r.fn.timepicker&&(e={appendTo:a.el.holder,disableTextInput:!0,timeFormat:wpforms_coupon_admin.time_format},a.dateTimePicker.el.scheduling.start.$tpicker.timepicker(e).on("selectTime",a.dateTimePicker.clearButtonsRefresh).on("showTimepicker",a.dateTimePicker.showTimepicker).on("hideTimepicker",a.dateTimePicker.hideTimepicker),a.dateTimePicker.el.scheduling.end.$tpicker.timepicker(e).on("selectTime",a.dateTimePicker.clearButtonsRefresh).on("showTimepicker",a.dateTimePicker.showTimepicker).on("hideTimepicker",a.dateTimePicker.hideTimepicker))},datePairInit:function(){var e={anchor:null,defaultDateDelta:0,dateClass:"wpforms-datepair-date",timeClass:"wpforms-datepair-time",startClass:"wpforms-datepair-start",endClass:"wpforms-datepair-end",parseDate:function(e){return r(e).prop("_flatpickr").selectedDates[0]},updateDate:function(e,t){e=r(e);e.prop("_flatpickr").setDate(t),a.dateTimePicker.clearButtonsRefresh(e),e.trigger("change")},updateTime:function(e,t){e=r(e);e.timepicker("setTime",t),a.dateTimePicker.clearButtonsRefresh(e),e.trigger("change")}};a.dateTimePicker.el.wrapper.datepair(e)},clearButtonsInit:function(){a.dateTimePicker.el.$clearButton.each(function(){var e=r(this);""===e.siblings('[id^="wpforms-coupons-"]').val()&&e.hide()})},clearButtonsRefresh:function(e){(e=e.target?r(e.target):e)&&""!==e.val()&&e.nextAll("button.wpforms-clear-datetime-field").show()},showTimepicker:function(){r(".ui-timepicker-wrapper").addClass("ui-timepicker-wrapper-focus")},hideTimepicker:function(){r(".ui-timepicker-wrapper").removeClass("ui-timepicker-wrapper-focus")},getArgs:function(o){o="start"===o?"start":"end";const r=a.dateTimePicker.el.scheduling[o].$tpicker,n=a.dateTimePicker.el.scheduling[o].$dpicker;return{altInput:!0,altFormat:wpforms_coupon_admin.date_format,dateFormat:wpforms_coupon_admin.date_format,onChange:function(e){var t={field:"start"===o?"end":"start"},i=(t.$dpicker=a.dateTimePicker.el.scheduling[t.field].$dpicker,t.$tpicker=a.dateTimePicker.el.scheduling[t.field].$tpicker,""===t.$dpicker.val()&&""===t.$tpicker.val()&&""!==n.val());(!0==i&&""!==n.val()&&""===r.val()&&""===t.$tpicker.val()||""!==t.$dpicker.val()&&""===t.$tpicker.val()&&""===r.val())&&(r.timepicker("setTime","00:00"),t.$tpicker.timepicker("setTime","00:00"),a.dateTimePicker.clearButtonsRefresh(r),a.dateTimePicker.clearButtonsRefresh(t.$tpicker)),!0==i&&"end"===o&&""===t.$dpicker.val()&&""===t.$dpicker.val()&&(t.$dpicker.prop("_flatpickr").setDate(new Date),a.dateTimePicker.clearButtonsRefresh(t.$dpicker)),a.dateTimePicker.clearButtonsRefresh(n)}}},updatePairedField:function(){const e=a.dateTimePicker.el.scheduling.start.$dpicker.val(),t=a.dateTimePicker.el.scheduling.start.$tpicker.val(),i=a.dateTimePicker.el.scheduling.end.$dpicker.val(),o=a.dateTimePicker.el.scheduling.end.$tpicker.val();var r,n;""!==e&&""!==i&&(n=(e+" "+t).replace(/-/g,"/"),r=(i+" "+o).replace(/-/g,"/"),n=new Date(n),new Date(r).getTime(),n.getTime())},resetField:function(){var e=r(this).siblings("input"),t=r(this).parent().next().find("input"),i=r(this).parent().next().find(".wpforms-clear-datetime-field");e.prop("_flatpickr")?e.prop("_flatpickr").clear():e.val(""),t.val(""),r(this).hide(),i.hide()}},generateCouponCode:function(){const e=r(".wpforms-btn-coupon-generate"),t=r("#wpforms-coupon-code"),i=e.html(),o=e.outerWidth();r.ajax({url:wpforms_admin.ajax_url,type:"GET",data:{nonce:wpforms_admin.nonce,action:"wpforms_coupons_generate_coupon_code"},dataType:"json",beforeSend:function(){e.css("width",o).text(wpforms_coupon_admin.generating).prop("disabled",!0)},success:function(e){t.val("").val(e.data)},error:function(e){console.log(e)},complete:function(){e.css("width","").html(i).prop("disabled",!1)}})},toggleAllowedFormsGlobal:function(){a.el.formsToggles.prop("checked",r(this).is(":checked"))},toggleSingleForm:function(){r(this).is(":checked")||a.el.isGlobalToggle.prop("checked",!1)},showAllForms:function(e){e.preventDefault();e=r(this);e.parent().find("table.wpforms-table-list").find("tr.wpforms-coupons-hidden").removeClass("wpforms-coupons-hidden"),e.hide()},tooltips:{init:function(){a.el.tooltips.length&&a.el.tooltips.tooltipster({contentAsHTML:!0,position:"top",maxWidth:300,multiple:!0,interactive:!0,debug:!1,functionReady(e){r(e.elementTooltip()).addClass("wpforms-tooltipster-coupons")}})}},beforeUnload:function(e){if(a.el.form.serialize()!==a.vars.savedFormData&&!a.vars.isReloadConfirmed)return e.returnValue=wpforms_coupon_admin.leave_page,e.returnValue},submitForm:function(){a.vars.isReloadConfirmed=!0},changeStep:function(){var e="flat"===r(this).val()?1/Math.pow(10,wpforms_coupon_admin.decimals):"0.01";r("#wpforms-coupon-amount").attr("step",e)}};return a}(document,window,jQuery);WPFormsCouponsAdmin.init();